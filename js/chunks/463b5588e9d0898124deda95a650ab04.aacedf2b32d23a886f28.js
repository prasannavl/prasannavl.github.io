webpackJsonp(["463b5588e9d0898124deda95a650ab04"],{"./src/components/Article.jsx":function(a,b,c){"use strict";function d(a,b){var c={};for(var d in a)0<=b.indexOf(d)||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=c("./node_modules/react/index.js"),i=c.n(h),j=c("./src/components/Head.jsx"),k=c("./node_modules/date-fns/format/index.js"),l=c.n(k),m=c("./src/modules/prism.worker.js"),n=c.n(m),o=c("./node_modules/classnames/index.js"),p=c.n(o),q=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},r=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),s=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={code:null},c.workerState=null,c.workerTask=null,c.worker=null,c}return g(b,a),r(b,[{key:"highlight",value:function(a){var b=this,c=a.children,d=a.lang;if(d){c=this.trimChildString(c);var e=this.workerTask=this.worker.highlight({code:c.toString(),lang:d}).then(function(a){e===b.workerTask&&b.setState({code:a})}).catch(function(a){return console.log(a)})}}},{key:"componentWillMount",value:function(){window.highlightWorkerState||(window.highlightWorkerState={worker:new n.a,ref:0}),this.workerState=window.highlightWorkerState,this.workerState.ref++,this.worker=this.workerState.worker,this.highlight(this.props)}},{key:"componentDidUpdate",value:function(a){this.props!=a&&this.highlight(a)}},{key:"componentWillUnmount",value:function(){this.workerState.ref--,0===this.workerState.ref&&(this.worker.terminate(),window.highlightWorkerState=null),this.workerTask=null,this.workerState=null,this.worker=null}},{key:"trimChildString",value:function(a){return"string"==typeof a&&a.startsWith("\n")?a.trim():a}},{key:"render",value:function(){var a=this.props,b=a.children,c=a.lang,e=a.className,f=d(a,["children","lang","className"]);b=this.state.code?this.state.code:this.trimChildString(b);var g=-1===b.indexOf("\n"),i=p()(e,{"single-line":g}),j=void 0;return j=i?{className:i}:{},Object(h.createElement)("pre",q({},f,j),Object(h.createElement)("code",{dangerouslySetInnerHTML:{__html:b}}))}}]),b}(i.a.Component),t=c("./src/components/Link.jsx");c.d(b,"a",function(){return u}),c.d(b,"b",function(){return s}),c.d(b,"c",function(){return t.a}),c.d(b,!1,function(){});var u=function(a){var b=a.title,c=a.date,d=a.modifiedDate,e=a.image,f=a.type,g=a.children,i=a.note,k="Prasanna Loganathar",m=a.description||(i?"Prasanna's personal notes on ":"Prasanna's blog article published on ")+new Date(c).toUTCString(),n=window.location.pathname.startsWith("/drafts");return Object(h.createElement)("article",null,Object(h.createElement)(j.b,null,b),Object(h.createElement)(j.c,{title:b,description:m,image:e}),Object(h.createElement)(j.a,{title:b,description:m,image:e,url:window.location.href,type:f||"article",author:k,time:c,modifiedTime:d}),Object(h.createElement)("header",{className:"mb-4"},Object(h.createElement)("h1",{className:"title",rel:"title"},b),Object(h.createElement)("p",{className:"d-none",rel:"author"},k),Object(h.createElement)("p",{className:"small text-muted",rel:"date"},Object(h.createElement)("time",{dateTime:c},l()(new Date(c),"dddd, Do MMM YYYY")))),n&&Object(h.createElement)("p",{className:"note-red"},"This is a ",Object(h.createElement)("strong",null,"draft")," - a work in progress. It's not yet meant for public consumption till it's published."),a.note&&Object(h.createElement)("p",{className:"note"},"This item is marked as a ",Object(h.createElement)("code",null,"note"),". ",Object(h.createElement)("em",null,"Notes")," are my personal archive of mostly tiny bits of information that serve as reference. It ",Object(h.createElement)("strong",null,"may or may not")," be accurate. ",Object(h.createElement)("strong",null,"You have been warned"),"."),g)}},"./src/modules/prism.worker.js":function(a,b,c){var d=c("./node_modules/workerize-loader/dist/rpc-wrapper.js"),e=["highlight"];a.exports=function(){var a=new Worker(c.p+"js/workers/main.f7818a85dcc0292261c3.worker.js",{name:"js/workers/[id].[chunkhash].worker.js"});return d(a,e),a}},"./src/posts/2016/02/crash-analysis-windows-graphics-stack-bug.jsx":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c.d(b,"meta",function(){return k});var d=c("./node_modules/react/index.js"),e=c.n(d),f=c("./src/components/Article.jsx"),g=c("./src/posts/2016/02/data/data-1.txt"),h=c.n(g),i=c("./src/posts/2016/02/data/data-2.txt"),j=c.n(i),k={title:"Crash Analysis: Windows Graphics Stack Bug",date:"2016-02-12T04:54:02.577Z",tags:["windows","kernel","crash-analysis"],description:"Crash analysis of a Graphics bug in the Windows 10 kernel based on Threshold/RedStone release"};b["default"]=function(){return Object(d.createElement)(f.a,k,Object(d.createElement)("p",{className:"note"},"This issue has been filed with Microsoft, and the current state of the issue can be followed up on Microsoft TechNet if you're affected by it or would like to add on to it here: ",Object(d.createElement)("a",{href:"https://social.technet.microsoft.com/Forums/en-US/d45e4063-3d73-4f51-a295-972f3be3a456/graphics-stack-bug-windows-10-build-threshold-release-10586-including-redstone?forum=win10itprogeneral"},"Graphics stack bug - Windows 10 Build Threshold Release (10586+, including RedStone)")),Object(d.createElement)("h2",null,"Affected Configuration"),Object(d.createElement)("ul",null,Object(d.createElement)("li",null,"Windows 10 - Threshold Release (10586+, including the initial builds of RedStone)"),Object(d.createElement)("li",null,"Intel HD Graphics 5500 with Nvidia GeForce 950M (Optimus pipeline)")),Object(d.createElement)("h2",null,"Context"),Object(d.createElement)("p",null,"A few weeks ago, being on the Insider Fast Ring, I updated myself to the first release based on the Redstone build likely during the first few hours. Some of the issues I noticed ended up being documented a few days later. My laptop was a HP Envy 15 with an Nvidia Optimus based GeForce 950M, and Intel HD Graphics 5500. However, I noticed weird issues as my screen turned black (but didn't switch off), and the cursor was occasionally visible once every 5-10 seconds or so (but cursor response took about 20-30 seconds). Strange. Most reasonable guess was the graphics driver. Hard reset of the laptop, and everything seemed to be quite fine. Strangely, there were no memory dumps (since the system actually didn't crash I guess), but fortunately the event logs did have a never-ending list of ",Object(d.createElement)("code",null,"Graphics card crashed and recovered unexpectedly.")),Object(d.createElement)("p",null,Object(d.createElement)("b",null,"The RedStone update also ended up in weird bugs and event logs filled with errors, mostly due to COM permission issues and so on"),". Meanwhile, a few hours later, there was an update available for my Intel HD 5500. Great, I was optimistic the issue was getting fixed. However, installing the driver (through Windows Update), ended up in the same blank screen again. Another hard reset, where Windows recovered itself to the last known state, and with similar errors. Meanwhile, my Nvidia card had an update. That was fast. Perhaps, that was the missing piece, and the Nvidia driver this time - same results. Since, the Optimus pipeline relies on the Intel card, it still provided nothing conclusive. Just blank screen. Another hard reset, but now I decided to do a full reset. (This was two days before it was documented that the RedStone build's ",Object(d.createElement)("em",null,"Reset")," ended up in an unusable system completely breaking it requiring a fresh clean install)."),Object(d.createElement)("p",null,"So, there it was. Now, I decided that I had enough with the new RedStone build, and move back to 10586 - the stable build. To my surprise, the graphics drivers ended up with the same result, and blank screen! Another hard reset and the graphics driver worked however. It always seemed to crash repeatedly during the install. However, thankfully, this time, I ended up with a lot of LiveKernelReports. Finally, we are getting somewhere. But a bit too many memorydumps."),Object(d.createElement)("p",null,Object(d.createElement)("img",{className:"img-fluid",src:c("./src/posts/2016/02/data/crash-analysis-screen-1.jpg"),alt:"[Screenshot 1]"})),Object(d.createElement)("p",null,Object(d.createElement)("strong",null,"493 minidumps!")," Hmm."),Object(d.createElement)("h2",null,"Analysis"),Object(d.createElement)("p",null,"Naturally, next step was to figure out what was wrong. So, WinDbg for all of them resulted in the following call stack:"),Object(d.createElement)(f.b,{children:h.a}),Object(d.createElement)("p",null,"Ok, that was ",Object(d.createElement)("strong",null,"dxgkrnl")," - the graphics stack. Next up the analysis ended up with straight forward message:"),Object(d.createElement)(f.b,{children:j.a}),Object(d.createElement)("p",null,"I'd have generally chalked it up as an Intel driver issue and moved on, however, interesting I received about 2 or 3 different updates from Windows Update for the same Intel Graphics driver. Windows update seemed to have been the most reliable place for drivers which are expected to have been well tested, but all of them ended up crashing exactly the same way."),Object(d.createElement)("h3",null,"Could it be the hardware?"),Object(d.createElement)("p",null,"This was an interesting issue since even the kernel logger failed to capture anything useful for the events on the release builds. And so, I had to ensure that the fault didn't lie in the hardware first. UEFI Diagnostics seemed to show no inconsistencies. Besides, older builds of Windows, coupled with older drivers (as well as my Linux OSes - though that might not necessarily prove much in this context) doesn't seem to have these problems. This issue didn't exist before the 10586 build, but seems to exist in all later insider builds till date."),Object(d.createElement)("p",{className:"note"},Object(d.createElement)("strong",null,"So, I was left with no reason to doubt the hardware.")),Object(d.createElement)("h3",null,"Potential cause"),Object(d.createElement)("p",null,"This was on the retail build (10586). And the same thing happens on Safe Mode as well during the installation. It generates numerous minidumps. The Insider builds for some reason didn't generate the minidumps which were generated on the retail build. So, based on the watchdog reports, it seems like ",Object(d.createElement)("strong",null,"the driver fails on infinite loop, but just not quickly enough for the watch dog to catch it and crash"),". So, it ends up on a blank screen instead of BSOD. However that doesn't explain the lack of more logging on when the driver crashed. So, that puts me on a track to the likely suspect: ",Object(d.createElement)("strong",null,"The Windows Graphics Stack"),". There has been a signficant amount of changes into the RedStone build, and there were also more bug stack bugs that were reported. But it could also be something terribly wrong in the driver."),Object(d.createElement)("p",null,"However without the correct symbols or the debug build, this is as much as I could narrow it down to. Likely, ",Object(d.createElement)("strong",null,"the problems lie in both the new Graphics Stack (which hopefully will get fixed in the newer builds), and Intel's driver"),"."),Object(d.createElement)("p",null,"The only real data that were reliable enough for analysis were the numerous minidumps. And my guess is that, even them, probably mostly only contains where the WatchDog timeouts happen, and likely provide an insight into the problematic driver and zones, though not helping much with the precise problem in the driver."),Object(d.createElement)("h2",null,"Minidumps"),Object(d.createElement)("p",null,"I did end up with a full memory dump and shared them with Microsoft. However, the rest of the minidumps are shared publicly here for the inquisitive minds:"),Object(d.createElement)("p",null,Object(d.createElement)("strong",null,"2016-Q1-Kernel-Graphics")," (OneDrive folder with all the dumps):",Object(d.createElement)("br",null),Object(d.createElement)("a",{href:"https://1drv.ms/f/s!Agt9I4vUjzpCg4d1Je-LckF4grKXnw"},"https://1drv.ms/f/s!Agt9I4vUjzpCg4d1Je-LckF4grKXnw")),Object(d.createElement)("p",null,"This includes the ",Object(d.createElement)("i",null,"LiveKernelReports")," (Watchdog dumps), and the ",Object(d.createElement)("i",null,"WER Kernel Reports"),"."))}},"./src/posts/2016/02/data/crash-analysis-screen-1.jpg":function(a,b,c){a.exports=c.p+"img/crash-analysis-screen-1.b66924924e48c2f26ff81708a3b809b4.jpg"},"./src/posts/2016/02/data/data-1.txt":function(a){a.exports="0: kd> k\n# Child-SP          RetAddr           Call Site\n00 ffffd000`275c3a00 fffff800`9d7671fc watchdog!WdDbgReportRecreate+0x104\n01 ffffd000`275c3a50 fffff800`9d76675f dxgkrnl!TdrUpdateDbgReport+0xec\n02 ffffd000`275c3aa0 fffff800`9d753345 dxgkrnl!TdrCollectDbgInfoStage2+0x1df\n03 ffffd000`275c3ad0 fffff800`9d766e65 dxgkrnl!DXGADAPTER::Reset+0x21d\n04 ffffd000`275c3b20 fffff800`9d766fbb dxgkrnl!TdrResetFromTimeout+0x15\n05 ffffd000`275c3b50 fffff803`35e78b79 dxgkrnl!TdrResetFromTimeoutWorkItem+0x5b\n06 ffffd000`275c3b80 fffff803`35e17125 nt!ExpWorkerThread+0xe9\n07 ffffd000`275c3c10 fffff803`35f55916 nt!PspSystemThreadStartup+0x41\n08 ffffd000`275c3c60 00000000`00000000 nt!KiStartSystemThread+0x16"},"./src/posts/2016/02/data/data-2.txt":function(a){a.exports="VIDEO_TDR_TIMEOUT_DETECTED (117)\nThe display driver failed to respond in timely fashion.\n(This code can never be used for a real bugcheck.)\nArguments:\nArg1: ffffe0011e57d4c0, Optional pointer to internal TDR recovery context (TDR_RECOVERY_CONTEXT).\nArg2: fffff800a4c620f0, The pointer into responsible device driver module (e.g owner tag).\nArg3: 0000000000000000, The secondary driver specific bucketing key.\nArg4: 0000000000000000, Optional internal context dependent data.\n\nDebugging Details:\n------------------\n\n\nDUMP_CLASS: 1\n\nDUMP_QUALIFIER: 400\n\nBUILD_VERSION_STRING:  10586.63.amd64fre.th2_release.160104-1513\n\nDUMP_TYPE:  2\n\nBUGCHECK_P1: ffffe0011e57d4c0\n\nBUGCHECK_P2: fffff800a4c620f0\n\nBUGCHECK_P3: 0\n\nBUGCHECK_P4: 0\n\nFAULTING_IP: \nigdkmd64+120f0\nfffff800`a4c620f0 ??              ???\n\nDEFAULT_BUCKET_ID:  GRAPHICS_DRIVER_TDR_TIMEOUT\n\nTAG_NOT_DEFINED_202b:  *** Unknown TAG in analysis list 202b\n\n\nCPU_COUNT: 4\n\nCPU_MHZ: 95a\n\nCPU_VENDOR:  GenuineIntel\n\nCPU_FAMILY: 6\n\nCPU_MODEL: 3d\n\nCPU_STEPPING: 4\n\nBUGCHECK_STR:  0x117\n\nPROCESS_NAME:  System\n\nCURRENT_IRQL:  0\n\nANALYSIS_SESSION_HOST:  PVL-FALCON\n\nANALYSIS_SESSION_TIME:  02-15-2016 06:26:31.0556\n\nANALYSIS_VERSION: 10.0.10586.567 amd64fre\n\nSTACK_TEXT:  \nffffd000`275c3a00 fffff800`9d7671fc : ffffe001`1e57d4c0 00000000`80000000 ffffe001`1e57d4c0 ffffe001`32fd3010 : watchdog!WdDbgReportRecreate+0x104\nffffd000`275c3a50 fffff800`9d76675f : ffffc000`00000000 ffffc000`cb9f1500 ffffe001`1e57d4c0 ffffe001`33482408 : dxgkrnl!TdrUpdateDbgReport+0xec\nffffd000`275c3aa0 fffff800`9d753345 : ffffc000`d1c89c24 ffffe001`334823a0 ffffe001`334823a0 ffffe001`33482408 : dxgkrnl!TdrCollectDbgInfoStage2+0x1df\nffffd000`275c3ad0 fffff800`9d766e65 : ffffe001`32370150 00000000`00000000 00000000`00000000 00000000`00000000 : dxgkrnl!DXGADAPTER::Reset+0x21d\nffffd000`275c3b20 fffff800`9d766fbb : 00000000`00000200 fffff803`361a1340 ffffe001`1c208c90 fffff803`35e90910 : dxgkrnl!TdrResetFromTimeout+0x15\nffffd000`275c3b50 fffff803`35e78b79 : ffffe001`333c7040 fffff800`9d766f60 ffffe001`1fe25610 fffff803`361a1340 : dxgkrnl!TdrResetFromTimeoutWorkItem+0x5b\nffffd000`275c3b80 fffff803`35e17125 : 00000005`b19bbdff 00000000`00000080 ffffe001`1b8a2040 ffffe001`333c7040 : nt!ExpWorkerThread+0xe9\nffffd000`275c3c10 fffff803`35f55916 : ffffd000`20720180 ffffe001`333c7040 fffff803`35e170e4 ffeceff1`ffeceff1 : nt!PspSystemThreadStartup+0x41\nffffd000`275c3c60 00000000`00000000 : ffffd000`275c4000 ffffd000`275be000 00000000`00000000 00000000`00000000 : nt!KiStartSystemThread+0x16\n\n\nSTACK_COMMAND:  kb\n\nTHREAD_SHA1_HASH_MOD_FUNC:  26032a29a837a16b5eba8813d816bfe6c3aea8a7\n\nTHREAD_SHA1_HASH_MOD_FUNC_OFFSET:  2a98f27881b30ef00b3362f6f34c45e22e7dcaf5\n\nTHREAD_SHA1_HASH_MOD:  7558c67383100ca76738f2615528c656f1c43af3\n\nFOLLOWUP_IP: \nigdkmd64+120f0\nfffff800`a4c620f0 ??              ???\n\nSYMBOL_NAME:  igdkmd64+120f0\n\nFOLLOWUP_NAME:  MachineOwner\n\nMODULE_NAME: igdkmd64\n\nIMAGE_NAME:  igdkmd64.sys\n\nDEBUG_FLR_IMAGE_TIMESTAMP:  5678d0a8\n\nFAILURE_BUCKET_ID:  LKD_0x117_IMAGE_igdkmd64.sys\n\nBUCKET_ID:  LKD_0x117_IMAGE_igdkmd64.sys\n\nPRIMARY_PROBLEM_CLASS:  LKD_0x117_IMAGE_igdkmd64.sys\n\nTARGET_TIME:  2016-02-02T11:24:05.000Z\n\nOSBUILD:  10586\n\nOSSERVICEPACK:  0\n\nSERVICEPACK_NUMBER: 0\n\nOS_REVISION: 0\n\nSUITE_MASK:  272\n\nPRODUCT_TYPE:  1\n\nOSPLATFORM_TYPE:  x64\n\nOSNAME:  Windows 10\n\nOSEDITION:  Windows 10 WinNt TerminalServer SingleUserTS\n\nOS_LOCALE:  \n\nUSER_LCID:  0\n\nOSBUILD_TIMESTAMP:  2016-01-05 06:58:56\n\nBUILDDATESTAMP_STR:  160104-1513\n\nBUILDLAB_STR:  th2_release\n\nBUILDOSVER_STR:  10.0.10586.63.amd64fre.th2_release.160104-1513\n\nANALYSIS_SESSION_ELAPSED_TIME: 5dc\n\nANALYSIS_SOURCE:  KM\n\nFAILURE_ID_HASH_STRING:  km:lkd_0x117_image_igdkmd64.sys\n\nFAILURE_ID_HASH:  {df5cc292-6e03-34f8-7849-e22c43f13df4}"}});